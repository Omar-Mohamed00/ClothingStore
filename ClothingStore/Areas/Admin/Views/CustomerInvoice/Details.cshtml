@using Models.ViewModels
@model CustomerInvoiceVM

<div class="row">
    <div class="col-md-9">
        <!-- Default box -->
        <div class="box box-primary">
            <div class="box-body">
                <div>
                    <dl class="dl-horizontal">
                        <dt>
                            @Html.DisplayNameFor(model => model.CustomerInvoice.invoiceNumber)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.CustomerInvoice.invoiceNumber)
                        </dd>
                        <dt>
                            @Html.DisplayNameFor(model => model.CustomerInvoice.Date)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.CustomerInvoice.Date)
                        </dd>
                        <dt>
                            @Html.DisplayNameFor(model => model.CustomerInvoice.Total)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.CustomerInvoice.Total)
                        </dd>
                        <dt>
                            @Html.DisplayNameFor(model => model.CustomerInvoice.Customer)
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.CustomerInvoice.Customer.Name)
                        </dd>
                    </dl>
                </div>
            </div>
            <!-- /.box-body -->
            <div class="box-footer">
                <div class="form-group">
                    <a asp-action="ShowInvoice" asp-route-id="@Model.CustomerInvoice.Id" class="btn btn-primary pull-right"><i class="fa fa-print"></i> Print Customer Invoice</a>
                    <a asp-action="Index" class="btn btn-default">Back to List</a>
                </div>
            </div>
            <!-- /.box-footer-->
        </div>
        <!-- /.box -->
    </div>
    <div class="col-md-3">
    </div>
</div>

<table id="customerInvoiceLineTable" class="table">
    <thead>
        <tr>
            <th>@Html.DisplayNameFor(model => model.CustomerInvoiceLine.product.Name)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerInvoiceLine.Quantity)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerInvoiceLine.Price)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerInvoiceLine.Discount)</th>
            <th>@Html.DisplayNameFor(model => model.CustomerInvoiceLine.SubAmount)</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.CustomerInvoiceList)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.product.Name)</td>
                <td>@Html.DisplayFor(modelItem => item.Quantity)</td>
                <td>@Html.DisplayFor(modelItem => item.Price)</td>
                <td>@Html.DisplayFor(modelItem => item.Discount)</td>
                <td>@Html.DisplayFor(modelItem => item.SubAmount)</td>
                <td class="align-middle">
                    <div class="d-flex justify-content-end">
                        <a class="btn btn-info rounded rounded-3 me-2" data-toggle="modal" data-target="#addCustomerInvoiceLine"
                           data-url="@Url.Action("Upsert", "CustomerInvoiceLine", new { id = item.customerInvoiceLineId })">
                            <i class="bi bi-pencil-fill"></i> تعديل
                        </a>
                        <a href="javascript:;" class="btn btn-danger rounded rounded-3 js-delete" data-id="@item.customerInvoiceLineId">
                            <i class="bi bi-trash3"></i>مسح
                        </a>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="row">
    <div class="col-md-9">
        <div class="box box-primary">
            <div id="upsertPartialContainer"></div> <!-- Placeholder for Partial View -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addCustomerInvoiceLine" data-url="@Url.Action("Upsert", "CustomerInvoiceLine")">
                اضافة منتج جديد
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Fetch the partial view via AJAX when the page loads
            $.ajax({
                url: '@Url.Action("Upsert", "CustomerInvoiceLine")', // Adjust ID as needed
                method: 'GET',
                success: function (response) {
                    // Inject the fetched partial view into the placeholder container
                    $('#upsertPartialContainer').html(response);
                },
                error: function (xhr, status, error) {
                    console.error("Error loading partial view:", error);
                }
            });
        });
        $(document).ready(function () {
            // Handle Add/Edit button clicks
            $('[data-toggle="modal"]').on('click', function () {
                const url = $(this).data('url'); // Get the URL from the button's data attribute

                if (url) {
                    // Fetch content via AJAX
                    $.ajax({
                        url: url,
                        method: 'GET',
                        success: function (response) {
                            // Inject the fetched content into the modal
                            $('#modalFormContent').html(response);
                        },
                        error: function (xhr, status, error) {
                            console.error("Error loading partial view:", error);
                            alert("An error occurred while loading the form.");
                        }
                    });
                }
            });
        });
    </script>
    <script src="~/js/CustomerInvoiceLine.js" asp-append-version="true"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>
}
